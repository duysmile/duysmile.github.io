---
title: 'OAuth là gì'
date: 2021-12-26
permalink: /posts/2022/01/oauth/
tags:
  - backend
  - authentication
  - exp
---
Tìm hiểu về OAuth

OAuth là gì?
======

1. Định nghĩa
- O có thể hiểu là Open, Auth ở đây là Authorization chứ không phải Authentication.
- OAuth là một phương thức xác thực giúp cho phép truy cập những resource của resource owner bằng cách bật một client application trên HTTP Services như Github, Facebook.
- OAuth cho phép chia sẻ tài nguyên lưu trữ ở site khác mà không cần credentials.

- Có thể dễ hình dung hơn qua ví dụ sau:
  - Truy cập vào Tiki và muốn login vào
  - Bạn chọn `Login with gmail`
  - Sau khi click vào sẽ hiện một popup, để ý trên thanh url của popup sẽ là đến từ google (hoặc gmail.com)
  - Nhập username, password để đăng nhập vào gmail của bạn
  - Sau khi dăng nhập thành công thì bạn sẽ thấy popup tắt và quay lại trang Tiki thì bạn đã đăng nhập
  - Khi này bạn sẽ thấy thông tin gmail của bản thân như avatar và tên đã được truy cập và lưu trữ ở Tiki.

- Ở dây có thể thấy chúng ta đã cấp quyền cho Tiki truy cập vào thông tin cơ bản trên Gmail
- Và ví dụ trên cũng chính là mục đích sử dụng của OAuth, ủy quyền cho một ứng dụng bên thứ ba truy cập vào resource ở bên ngoài ứng dụng của bạn mà không cần nhập username, password của bạn trên trang đó.

2. Flow

- Hiện tại có 2 version OAuth là OAuth1 và OAuth2
- Thêm nhiều OAuth flow sẽ hỗ trợ tốt hơn cho nhiều ứng dụng không phải trên browser
- Với OAuth1 thì những ứng dụng desktop hay mobile phải hướng dẫn người dùng mở trình duyệt của họ truy cập đến dịch vụ mong muốn và xác thực với service đó sau đó copy token từ đó đưa về ứng dụng. Việc này mang lại trải nghiệm rất tệ.
- Và với OAuth2 thì chúng ta đã có cách khác để có thể lấy ủy quyền (authorization) cho người dùng.
- OAuth2 không còn yêu cầu ứng dụng client phải mã hóa, mà chỉ cần request kèm với `issued token` thông qua HTTPs. Signature của OAuth2 không còn quá phức tạp, không cần phải parsing, sorting hay encoding nữa.
- Token trong OAuth2 là `short-lived`. Với OAuth1 thì token gần như là không expired. OAuth2 giới thiệu một loại token đó chính là refresh token. Access token sẽ là short-lived nhưng refresh token sẽ có thời hạn lâu hơn và dùng để yêu cầu cấp một access token mới thay vì bắt user phải xác thực lại với ứng dụng.
- Và trong OAuth 2 thì phần tách rõ ràng vai trò giữa server chịu trách nhiệm xử lí request OAuth và server xử lí việc xác thực người dùng.

- Để hiểu rõ hơn quy trình cũng như cách mà OAuth hoạt động thì cùng xem qua những hình minh họa dưới đây.
![OAuth2 Flow](https://i.stack.imgur.com/Xn4c0.png)
![OAuth1 Flow](https://i.stack.imgur.com/UmvA7.png)

3. Resources:
- https://www.varonis.com/blog/what-is-oauth/
- https://stackoverflow.com/questions/4113934/how-is-oauth-2-different-from-oauth-1/35775049#35775049
- https://www.tutorialspoint.com/oauth2.0/oauth2.0_overview.htm

